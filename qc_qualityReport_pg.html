<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daily Quality Report</title>
         <script type="module" src="auth-guard.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1rem;
        }

        .content {
            padding: 30px;
        }

        .dashboard {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            text-align: center;
        }

        .stat-number {
            font-size: 1.8rem;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }

        .stat-label {
            color: #666;
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .chart-container {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        }

        .chart-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 15px;
            text-align: center;
        }

        .form-section {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            margin-bottom: 30px;
        }

        .form-section h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.5rem;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group-full {
            grid-column: 1 / -1;
        }

        label {
            font-weight: 600;
            color: #555;
            margin-bottom: 8px;
            font-size: 0.95rem;
        }

        input, textarea, select {
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: #fafbfc;
        }

        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #667eea;
            background: white;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        textarea {
            resize: vertical;
            min-height: 80px;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }

        .reports-list {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        }

        .reports-list h2 {
            background: #f8f9fa;
            padding: 20px;
            margin: 0;
            color: #333;
            border-bottom: 1px solid #e9ecef;
        }

        .report-item {
            border-bottom: 1px solid #e9ecef;
            padding: 20px;
            transition: all 0.3s ease;
            position: relative;
        }

        .report-item:hover {
            background: #f8f9fa;
            transform: translateX(5px);
        }

        .report-item:last-child {
            border-bottom: none;
        }

        .report-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .report-sebango {
            font-size: 1.3rem;
            font-weight: 600;
            color: #333;
        }

        .report-badges {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-close {
            background: #d1edff;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        .status-pending {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }

        .rank-1 {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .rank-2 {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }

        .rank-3 {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        .report-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }

        .detail-section {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .detail-title {
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
            font-size: 0.9rem;
        }

        .detail-content {
            color: #666;
            line-height: 1.4;
            font-size: 0.95rem;
        }

        .report-actions {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 0.8rem;
            border-radius: 15px;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-toggle {
            background: #28a745;
            color: white;
        }

        .btn-toggle:hover {
            background: #218838;
            transform: translateY(-1px);
        }

        .btn-delete {
            background: #dc3545;
            color: white;
        }

        .btn-delete:hover {
            background: #c82333;
            transform: translateY(-1px);
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #888;
        }

        .chart-placeholder {
            width: 100%;
            height: 200px;
            background: #f8f9fa;
            border: 2px dashed #dee2e6;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #6c757d;
            font-size: 1.1rem;
        }

        @media (max-width: 768px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .report-details {
                grid-template-columns: 1fr;
            }
            
            .report-actions {
                position: static;
                margin-top: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Daily Quality Report</h1>
            <p>Quality Control and Defect Management System</p>
        </div>

        <div class="content">
            <div class="dashboard">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number" id="totalReports">0</div>
                        <div class="stat-label">Total Reports</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="pendingReports">0</div>
                        <div class="stat-label">Pending</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="closedReports">0</div>
                        <div class="stat-label">Closed</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="rank1Issues">0</div>
                        <div class="stat-label">Rank 1 Issues</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="totalDefects">0</div>
                        <div class="stat-label">Total Defects</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="totalScrap">0</div>
                        <div class="stat-label">Total Scrap</div>
                    </div>
                </div>
                
                <div class="chart-container">
                    <div class="chart-title">Daily Report Trend</div>
                    <canvas id="reportChart" width="400" height="200"></canvas>
                </div>
            </div>

            <div class="form-section">
                <h2>Add New Quality Report</h2>
                <form id="reportForm">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="sebangoNo">Sebango No *</label>
                            <input type="text" id="sebangoNo" required placeholder="Enter Sebango number">
                        </div>
                        
                        <div class="form-group">
                            <label for="quantityDefect">Quantity Defect *</label>
                            <input type="number" id="quantityDefect" required placeholder="Enter defect quantity" min="0">
                        </div>
                        
                        <div class="form-group">
                            <label for="quantityScrap">Quantity Scrap *</label>
                            <input type="number" id="quantityScrap" required placeholder="Enter scrap quantity" min="0">
                        </div>
                        
                        <div class="form-group">
                            <label for="categoryRank">Category - Rank Issue *</label>
                            <select id="categoryRank" required>
                                <option value="">Select Rank Level</option>
                                <option value="1">Rank 1 (Critical)</option>
                                <option value="2">Rank 2 (Major)</option>
                                <option value="3">Rank 3 (Minor)</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="reportStatus">Status *</label>
                            <select id="reportStatus" required>
                                <option value="">Select Status</option>
                                <option value="pending">Pending</option>
                                <option value="close">Close</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-grid">
                        <div class="form-group form-group-full">
                            <label for="detailsIssues">Details Issues *</label>
                            <textarea id="detailsIssues" required placeholder="Describe the quality issues in detail..."></textarea>
                        </div>
                    </div>
                    
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="temporaryAction">Temporary Action *</label>
                            <textarea id="temporaryAction" required placeholder="Describe immediate temporary actions taken..."></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label for="newAction">New Action *</label>
                            <textarea id="newAction" required placeholder="Describe new corrective actions..."></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label for="actionRequired">Action Required *</label>
                            <textarea id="actionRequired" required placeholder="Specify actions required for resolution..."></textarea>
                        </div>
                    </div>
                    
                    <button type="submit" class="btn">Add Quality Report</button>
                </form>
            </div>

            <div class="reports-list">
                <h2>Quality Reports</h2>
                <div id="reportsList">
                    <div class="empty-state">
                        <h3>No quality reports added yet</h3>
                        <p>Add your first quality report using the form above</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        class QualityReportManager {
            constructor() {
                this.reports = [];
                this.currentId = 1;
                this.chart = null;
                this.init();
            }

            init() {
                document.getElementById('reportForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.addReport();
                });

                this.renderReports();
                this.updateStats();
                this.initChart();
            }

            addReport() {
                const form = document.getElementById('reportForm');

                const report = {
                    id: this.currentId++,
                    sebangoNo: document.getElementById('sebangoNo').value.trim(),
                    detailsIssues: document.getElementById('detailsIssues').value.trim(),
                    quantityDefect: parseInt(document.getElementById('quantityDefect').value) || 0,
                    quantityScrap: parseInt(document.getElementById('quantityScrap').value) || 0,
                    temporaryAction: document.getElementById('temporaryAction').value.trim(),
                    newAction: document.getElementById('newAction').value.trim(),
                    actionRequired: document.getElementById('actionRequired').value.trim(),
                    categoryRank: document.getElementById('categoryRank').value,
                    status: document.getElementById('reportStatus').value,
                    createdAt: new Date().toISOString(),
                    date: new Date().toISOString().split('T')[0]
                };

                // Validation
                if (!report.sebangoNo || !report.detailsIssues || !report.temporaryAction || 
                    !report.newAction || !report.actionRequired || !report.categoryRank || !report.status) {
                    alert('Please fill in all required fields');
                    return;
                }

                this.reports.unshift(report);
                this.renderReports();
                this.updateStats();
                this.updateChart();
                form.reset();
            }

            toggleStatus(id) {
                const report = this.reports.find(r => r.id === id);
                if (report) {
                    report.status = report.status === 'pending' ? 'close' : 'pending';
                    this.renderReports();
                    this.updateStats();
                }
            }

            deleteReport(id) {
                if (confirm('Are you sure you want to delete this report?')) {
                    this.reports = this.reports.filter(r => r.id !== id);
                    this.renderReports();
                    this.updateStats();
                    this.updateChart();
                }
            }

            updateStats() {
                const total = this.reports.length;
                const pending = this.reports.filter(r => r.status === 'pending').length;
                const closed = this.reports.filter(r => r.status === 'close').length;
                const rank1 = this.reports.filter(r => r.categoryRank === '1').length;
                const totalDefects = this.reports.reduce((sum, r) => sum + r.quantityDefect, 0);
                const totalScrap = this.reports.reduce((sum, r) => sum + r.quantityScrap, 0);

                document.getElementById('totalReports').textContent = total;
                document.getElementById('pendingReports').textContent = pending;
                document.getElementById('closedReports').textContent = closed;
                document.getElementById('rank1Issues').textContent = rank1;
                document.getElementById('totalDefects').textContent = totalDefects;
                document.getElementById('totalScrap').textContent = totalScrap;
            }

            initChart() {
                const canvas = document.getElementById('reportChart');
                const ctx = canvas.getContext('2d');
                
                // Simple chart placeholder
                ctx.fillStyle = '#f8f9fa';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                ctx.fillStyle = '#667eea';
                ctx.font = '16px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('Chart will show daily report trends', canvas.width/2, canvas.height/2);
            }

            updateChart() {
                // Update chart with new data
                this.initChart();
            }

            renderReports() {
                const container = document.getElementById('reportsList');
                
                if (this.reports.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <h3>No quality reports added yet</h3>
                            <p>Add your first quality report using the form above</p>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = this.reports.map(report => `
                    <div class="report-item">
                        <div class="report-actions">
                            <button class="btn-small btn-toggle" onclick="manager.toggleStatus(${report.id})">
                                ${report.status === 'pending' ? 'Mark Close' : 'Mark Pending'}
                            </button>
                            <button class="btn-small btn-delete" onclick="manager.deleteReport(${report.id})">Delete</button>
                        </div>
                        
                        <div class="report-header">
                            <div class="report-sebango">Sebango No: ${this.escapeHtml(report.sebangoNo)}</div>
                            <div class="report-badges">
                                <span class="badge status-${report.status}">${report.status}</span>
                                <span class="badge rank-${report.categoryRank}">Rank ${report.categoryRank}</span>
                            </div>
                        </div>
                        
                        <div class="report-details">
                            <div class="detail-section">
                                <div class="detail-title">Issues Details</div>
                                <div class="detail-content">${this.escapeHtml(report.detailsIssues)}</div>
                            </div>
                            
                            <div class="detail-section">
                                <div class="detail-title">Quantities</div>
                                <div class="detail-content">
                                    Defects: ${report.quantityDefect}<br>
                                    Scrap: ${report.quantityScrap}
                                </div>
                            </div>
                            
                            <div class="detail-section">
                                <div class="detail-title">Temporary Action</div>
                                <div class="detail-content">${this.escapeHtml(report.temporaryAction)}</div>
                            </div>
                            
                            <div class="detail-section">
                                <div class="detail-title">New Action</div>
                                <div class="detail-content">${this.escapeHtml(report.newAction)}</div>
                            </div>
                            
                            <div class="detail-section">
                                <div class="detail-title">Action Required</div>
                                <div class="detail-content">${this.escapeHtml(report.actionRequired)}</div>
                            </div>
                            
                            <div class="detail-section">
                                <div class="detail-title">Report Info</div>
                                <div class="detail-content">
                                    Created: ${this.formatDateTime(report.createdAt)}<br>
                                    Rank: ${report.categoryRank} (${this.getRankLabel(report.categoryRank)})
                                </div>
                            </div>
                        </div>
                    </div>
                `).join('');
            }

            getRankLabel(rank) {
                const labels = {
                    '1': 'Critical',
                    '2': 'Major', 
                    '3': 'Minor'
                };
                return labels[rank] || 'Unknown';
            }

            escapeHtml(text) {
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }

            formatDateTime(dateTimeStr) {
                if (!dateTimeStr) return 'Not set';
                const date = new Date(dateTimeStr);
                return date.toLocaleString('en-US', { 
                    year: 'numeric', 
                    month: 'short', 
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
            }
        }

        // Initialize the manager
        const manager = new QualityReportManager();
    </script>
</body>
</html>